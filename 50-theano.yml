---
- hosts: all
  become: yes
  tasks:
    - name: check if variables are defined
      fail: msg='define vars - package_state'
      when: package_state is undefined or main_user is undefined
    
    - name: check if {{ main_user }} account is created
      shell: shell /usr/bin/getent passwd {{ main_user }} | /usr/bin/wc -l | tr -d ' '
      register: main_user_exists
      failed_when: "'0' in main_user_exists.stdout"

    - name: install Theano
      pip: name=Theano state={{ package_state }}
    
    - name: ensure [nvcc] exists in ~/.theanorc
      lineinfile: dest=/home/{{ main_user }}/.theanorc line="[nvcc]" state=present

# THEANO_FLAGS=device=gpu0 python check1.py
